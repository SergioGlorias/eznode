# debian:11-slim
ARG BASE_IMAGE=debian@sha256:b771c35d1e6ecf2556718ad3c0f481b4a04c1fbc133c609643acc9dd6743ead2
FROM $BASE_IMAGE

# See the 'docker' directory for arm32v7/arm64v8

# Build settings
ARG INSTALL=bitcoind,bwt,btc-rpc-explorer,specter,tor,nginx,letsencrypt,dropbear,wizard
ARG DEV

ARG BWT_VERSION=0.2.4
ARG BWT_ARCH=x86_64-linux
ARG BWT_SHA256=a98fc1820e53d928d58253c9e45327deb6339f30afe443350d29662937095c0f

ARG BITCOIND_VERSION=22.0.knots20211108
ARG BITCOIND_KNOTS_VERSION=22.x
ARG BITCOIND_ARCH=x86_64-linux-gnu
ARG BITCOIND_SHA256=9fcd747425d57611a7b117a80b7ecac93bcbef03a36a358bc40f11162748f492

ARG BTCEXP_VERSION=3.3.0
ARG BTCEXP_SHA256=52f6f559310df04450f819983c1d78223f3ed48e3ec520242201557adf063e20

ARG SPECTER_VERSION=1.9.4
ARG SPECTER_SHA256=afb564d9cab5d6409653278a62b3de86d8bf3c68aec6968aef1830652ad02172

ARG S6_OVERLAY_VERSION=2.2.0.3
ARG S6_OVERLAY_ARCH=amd64
ARG S6_OVERLAY_SHA256=a7076cf205b331e9f8479bbb09d9df77dbb5cd8f7d12e9b74920902e0c16dd98

ARG NODEJS_VERSION=16.14.2
ARG NODEJS_ARCH=linux-x64
ARG NODEJS_SHA256=57e02c27eb5e52f560f72d96240e898cb52818dc9fc50f45478ce39ece38583a

COPY . /tmp/setup
RUN (cd /tmp/setup && ./install.sh) && rm -r /tmp/*

# Runtime settings
ENV NETWORK=bitcoin
ENV BWT=1
ENV EXPLORER=1
ENV SPECTER=0
ENV TOR=0
ENV SSL=0
ENV SSHD=0
ENV BWT_LOGS=1

ENV PATH=/ez/bin:$PATH
ENTRYPOINT ["/ez/entrypoint.sh"]
